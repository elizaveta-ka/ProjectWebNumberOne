<!DOCTYPE HTML>
<html xmlns:th="http://www.w3.org/1999/xhtml">
<!--      th:fragment="main-fragment (title, otherStaticResources, header, SideMenu, mainContent, footer)">-->
<head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script type="text/javascript" th:src="@{/js/profileForm.js}"></script>
    <script type="text/javascript" th:src="@{/js/star_rating.js}"></script>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <link rel="stylesheet" type="text/css" th:href="@{/main.css}" href="../../../static/main.css"/>
    <title>Product Page</title>

</head>
<script src="https://api-maps.yandex.ru/2.1/?lang=ru_RU&amp;apikey=<ваш API-ключ>" type="text/javascript"></script>
<script src="https://yandex.st/jquery/2.2.3/jquery.min.js" type="text/javascript"></script>
<!--<script src="request_map.js" type="text/javascript"></script>-->
<script>


    // Как только будет загружен API и готов DOM, выполняем инициализацию
    ymaps.ready(init);


    // Инициализация и уничтожение карты при нажатии на кнопку.
    function init () {
        var geolocation = ymaps.geolocation;
        var loc = document.getElementById("loc").innerHTML;
        var locArr = loc.split(", ");
        var loc1 = locArr[0];
        var loc2 = locArr[1];
        var myMap;
        document.getElementById("map").hidden = true;
        $('#toggle').bind({
            click: function () {
                document.getElementById("map").hidden = false;
                if (!myMap) {
                    myMap = new ymaps.Map('map', {
                        center: [loc1, loc2],
                        zoom: 15
                        // controls: ['geolocationControl']
                    }, {
                        searchControlProvider: 'yandex#search'
                    });

                    // Создаем геообъект с типом геометрии "Точка".
                                        myGeoObject = new ymaps.GeoObject({
                                            // Описание геометрии.
                                            geometry: {
                                                type: "Point",
                                                coordinates: [loc1, loc2]
                                            },
                                            // Свойства.
                                            properties: {
                                                // Контент метки.
                                                iconContent: "РЕСТИК СУПЕР!!!"

                                            }
                                        }, {
                                            // Опции.
                                            // Иконка метки будет растягиваться под размер ее содержимого.
                                            preset: 'islands#blackStretchyIcon',
                                            // Метку можно перемещать.
                                            draggable: true
                                        });
                    // Сравним положение, вычисленное по ip пользователя и
                    // положение, вычисленное средствами браузера.
                    geolocation.get({
                        provider: 'yandex',
                        mapStateAutoApply: true
                    }).then(function (result) {
                        // Красным цветом пометим положение, вычисленное через ip.
                        result.geoObjects.options.set('preset', 'islands#redCircleIcon');
                        result.geoObjects.get(0).properties.set({
                            balloonContentBody: 'Мое местоположение'
                        });
                        myMap.geoObjects.add(result.geoObjects);
                    });

                    geolocation.get({
                        provider: 'browser',
                        mapStateAutoApply: true
                    }).then(function (result) {
                        // Синим цветом пометим положение, полученное через браузер.
                        // Если браузер не поддерживает эту функциональность, метка не будет добавлена на карту.
                        result.geoObjects.options.set('preset', 'islands#blueCircleIcon');
                        myMap.geoObjects.add(result.geoObjects);
                    });
                                    myMap.geoObjects
                                        .add(myGeoObject)

                                        .add(new ymaps.Placemark([loc1, loc2], {
                                            balloonContent:

                                                document.getElementById("nameofBr").innerHTML
                                                + " " + document.getElementById("loc").innerHTML
                                        }, {

                                            preset: 'islands#icon',
                                            iconColor: '#0095b6'
                                        }));

                    $("#toggle").attr('value', 'Скрыть карту');
                }
                else {
                    document.getElementById("map").hidden = true;
                    myMap.destroy();// Деструктор карты
                    myMap = null;
                    $("#toggle").attr('value', 'Показать карту снова');
                }
            }
        });
    }


</script>
<header>
    <h2>Booze buddy</h2>

</header>
<body>
<section>
    <SideMenu id="SideMenu">
        <li><a th:id="home" th:href="@{/buddy/{id}(id=${homeId})}">Home</a></li>
        <li><a th:href="@{/feed}">Feed</a></li>
        <li><a th:href="@{/friend}">Find friends</a></li>
        <li><span style=vertical-align:bottom><a th:href="@{/logout}">Log out</a> </span></li>
    </SideMenu>
    <article>
        <div id="num_block">
            <h1 hidden id="buddIdHo" th:text = "${homeId}"
                th:data-home="${homeId}"> id </h1>
        </div>

        <div id="product_block">
            <div th:fragment="product">
                <h1 hidden id="role" th:text = "${user.role.id}"
                    th:data-role="${user.role.id}"> role </h1>
                <h1 th:text="${product.productName}"> Product_NAME </h1>
                <p><img th:src="@{${product.productImg}}" alt="Buddy image" width="130" height="180"></p>
                <p th:text="${product['productCategory']['categoryName']}">Category_NAME</p>
                <div class="tabs">
                    <input type="radio" name="inset" value="" id="tab_1" checked>
                    <label for="tab_1">Rating</label>

                    <input type="radio" name="inset" value="" id="tab_2">
                    <label for="tab_2">Suggestions</label><br>

                    <div id="rating">
                        <span id = "mark" th:text="${product.prRating}"> Rate_P1</span></div>
                    <div id="suggestions" th:each="s : ${product.productCategory.suggestions}">
                        <span th:text="${s.foodName} + ${', '} + ${s.foodImg}"></span>
                    </div>

<!--                    <div id="geo_block">-->
<!--                        <div th:each = "bR : ${product.businesses}" ><p id = "point" th:value="${bR.location}">Business_NAME, Business_LocationE<p>-->
<!--                            <input type="button" value="Продукт на карте" id="toggle"/>-->
<!--                            <p>-->
<!--                            <div id="map" style="width: 450px; height: 320px"></div>-->
<!--                            </p>-->
<!--                        </div>-->
<!--                    </div>-->
                    <br>
                </div>
            </div>
        </div><br>

        <p>

        </p>
        <div id = "rating_add"><form id="addReviewForm" class="form-control" method="post" th:object="${productReview}">
            Review title:<br>
            <br>
            <div><label for="reviewTitle"><input class="reviewTitlePr" id = "reviewTitle" type="text" th:value="${reviewTitle}" name="reviewTitle"/> </label></div>
            Review:<br>
            <div><label for="reviewProduct"><textarea class="reviewProductPr" id = "reviewProduct" th:value="${reviewProduct}" name="reviewProduct"></textarea> </label></div>
            <div><label for="rateP1"><input id="rateP1" type="text" th:value="${rateP1}" name="rateP1" value=""></label></div>
            <div id="rating_new">
                <div class="param">Параметр 1:</div>
                <div><div class="stars"></div><p class="progress" id="p1"></p></div>
                <div class="rating_new" id="param1">5.0</div>
                <div class="param">Параметр 2:</div>
                <div><div class="stars"></div><p class="progress" id="p2"></p></div>
                <div class="rating_new" id="param2">5.0</div>
                <div class="param">Параметр 3:</div>
                <div><div class="stars"></div><p class="progress" id="p3"></p></div>
                <div class="rating_new" id="param3">5.0</div>
                <div class="param">Общая оценка:</div>
                <div><div id="sum_stars"></div><p id="sum_progress"></p></div>
                <div id="summ">5.00</div>
                <input name="Add review" id="submitButton" type="submit" value="add-review">
            </div>
        </form></div>

        <div id="rateBlock" th:each="review : ${product.productReviews}">
            <p th:text="${review.buddy.firstName} + ${' '} + ${review.buddy.lastName}">Author</p>
            <p><a th:href="@{/buddy/{id}(id=${review.buddy.buddyId})}"><img th:src="@{${review.buddy.avatarImg}}" alt="Buddy image" width="150" height="180"></a></p>
            <p th:text="${review.reviewProduct}"> Review_title</p><br>
            <div id="rating_pr">
                <span th:text="${review.rateP1}"> Rate_P1</span>

            </div></div><br>
        <div id="business_block">
                <div th:each = "bR : ${product.businesses}" ><p th:text="${bR.busName} + ${', '} + ${bR.location}">Business_NAME, Business_LocationE<p>

                    <label  name="loc" th:field="${bR.location}" hidden id="loc" th:value="${bR.location}" th:text = "${bR.location}"/>
                    <label  name="loc" th:field="${bR.busName}" hidden id="nameofBr" th:value="${bR.busName}" th:text = "${bR.busName}"/>
                    <p align="right"> <button onclick ="window.location.href='{{link}(link=${bR.businessLink})}';">Book a table</button></p>
                    <p><a th:href="@{/business/{id}(id=${bR.businessId})}"><img th:src="@{${bR.busImg}}" alt="Buddy image" width="900" height="600"></a></p>
                <p th:text="${Distance}">2 km away</p>
                    <input type="button" value="Показать карту" id="toggle"  />
                    <div id="map" style="width: 450px; height: 320px"></div>
            </div>
        </div>

    </article><br>
</section>
<style type="text/css">
    .param, #rating_new, #summ { line-height: 28px; }
    .stars, #sum_stars { background: url(/images/stars.png); }
    .stars, #sum_stars, .progress, #sum_progress {
        width: 130px;
        height: 28px;
        cursor: pointer;
    }
</style>
</body>
<footer>
    <p>All right reserved and belong to almighty Cthulhu</p>
    <script src="//code.jquery.com/jquery-1.11.0.min.js"></script>

</footer>
</html>